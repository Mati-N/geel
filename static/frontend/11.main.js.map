{"version":3,"sources":["webpack:///./src/components/post/PostItem.js","webpack:///./src/components/layout/Error.js","webpack:///./src/components/post/Post.js"],"names":["Liked","lazy","Heart","Comments","PostItem","text","title","username","id","likes","creation","user_id","initialState","done","hasMore","height","loading","comments","useLazyQuery","LIKED","variables","post_id","onCompleted","data","setState","state","liked","useState","hovered","setHovered","self","useRef","useMutation","LIKE","likePost","expandText","useSpring","to","maxHeight","expand","current","scrollHeight","from","duration","useEffect","clientHeight","className","date","seconds","Math","floor","Date","interval","flr","timeSince","pre","ref","style","onClick","error","console","log","then","post","likers","length","onMouseOver","onMouseOut","Error","componentStack","resetErrorBoundary","role","Post","match","params","useQuery","GET_POST","fetchMore","refetch","spin","setSpin","size","node","posts","edges","FallbackComponent","key","commentSet","user","postComments","map","Link","onEnter","query","cursor","pageInfo","endCursor","updateQuery","previousResult","fetchMoreResult","hasNextPage","newEdges","__typename"],"mappings":"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","file":"11.main.js","sourcesContent":["import React, { useState, useEffect, useRef, lazy } from \"react\";\r\nimport { useLazyQuery, useMutation } from \"@apollo/client\";\r\nimport { LIKED, LIKE } from \"../../Queries\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { useSpring, animated } from \"react-spring\";\r\n\r\nconst Liked = lazy(() => import(\"../SVG/Like.svg\"));\r\nconst Heart = lazy(() => import(\"../SVG/Heart.svg\"));\r\nconst Comments = lazy(() => import(\"../SVG/Comments.svg\"));\r\n\r\nconst PostItem = ({\r\n  text,\r\n  title,\r\n  username,\r\n  id,\r\n  likes,\r\n  creation,\r\n  user_id,\r\n  comments,\r\n}) => {\r\n  const initialState = {\r\n    done: false,\r\n    likes,\r\n    hasMore: false,\r\n    height: \"32vh\",\r\n    loading: false,\r\n    comments,\r\n  };\r\n  const [liked] = useLazyQuery(LIKED, {\r\n    variables: { post_id: id },\r\n    onCompleted: (data) => {\r\n      setState({ ...state, liked: data.liked });\r\n    },\r\n  });\r\n\r\n  const [hovered, setHovered] = useState(false);\r\n  const self = useRef(null);\r\n\r\n  const [likePost] = useMutation(LIKE);\r\n  const [state, setState] = useState(initialState);\r\n\r\n  const expandText = useSpring({\r\n    to: {\r\n      maxHeight: state.expand ? `${self.current.scrollHeight}px` : \"230px\",\r\n      height: state.expand ? `${self.current.scrollHeight}px` : \"230px\",\r\n    },\r\n    from: {\r\n      maxHeight: !state.expand ? \"230px\" : `${self.current.scrollHeight}px`,\r\n      height: !state.expand ? \"230px\" : `${self.current.scrollHeight}px`,\r\n    },\r\n    duration: \"1s\",\r\n  });\r\n\r\n  useEffect(() => {\r\n    liked();\r\n    setState({\r\n      ...state,\r\n      hasMore: self.current.scrollHeight > self.current.clientHeight,\r\n      loading: false,\r\n    });\r\n  }, []);\r\n\r\n  const timeSince = (date) => {\r\n    let seconds = Math.floor((new Date() - date) / 1000);\r\n\r\n    let interval = seconds / 31536000;\r\n    if (interval > 1) {\r\n      const flr = Math.floor(interval);\r\n      return Math.floor(interval) + (flr === 1 ? \" year\" : \" years\");\r\n    }\r\n\r\n    interval = seconds / 2592000;\r\n    if (interval > 1) {\r\n      const flr = Math.floor(interval);\r\n      return flr + (flr === 1 ? \" month\" : \" months\");\r\n    }\r\n\r\n    interval = seconds / 86400;\r\n    if (interval > 1) {\r\n      const flr = Math.floor(interval);\r\n      return Math.floor(flr) + (flr === 1 ? \" day\" : \" days\");\r\n    }\r\n\r\n    interval = seconds / 3600;\r\n    if (interval > 1) {\r\n      const flr = Math.floor(interval);\r\n      return flr + (flr === 1 ? \" hour\" : \" hours\");\r\n    }\r\n\r\n    interval = seconds / 60;\r\n    if (interval > 1) {\r\n      const flr = Math.floor(interval);\r\n      return flr + (flr == 1 ? \" minute\" : \" minutes\");\r\n    }\r\n    return \"Seconds\";\r\n  };\r\n\r\n  const like = () => {\r\n    likePost({ variables: { post_id: id } })\r\n      .catch((error) => console.log(error))\r\n      .then(({ data: { likePost } }) => {\r\n        setState({\r\n          ...state,\r\n          liked: !state.liked,\r\n          likes: likePost.post.likers.length,\r\n        });\r\n      });\r\n  };\r\n\r\n  return (\r\n    <div className=\"post card\">\r\n      <div className=\"post-top card-top\">\r\n        <div className=\"post-info-top\">\r\n          <Link to={`user/${user_id}`} className=\"post-user\">\r\n            {\" \"}\r\n            {username}{\" \"}\r\n          </Link>\r\n          <small className=\"post-time\">\r\n            {timeSince(new Date(creation))} ago{\" \"}\r\n          </small>\r\n        </div>\r\n        <h5 className=\"post-title\">{title}</h5>\r\n      </div>\r\n      <animated.pre\r\n        ref={self}\r\n        className={`post-text`}\r\n        style={state.hasMore ? expandText : {}}\r\n      >\r\n        {text}\r\n        {state.hasMore && (\r\n          <button\r\n            className=\"more\"\r\n            onClick={() => {\r\n              setState({ ...state, expand: !state.expand });\r\n            }}\r\n          >\r\n            {state.expand ? \"less\" : \"more\"}\r\n          </button>\r\n        )}\r\n      </animated.pre>\r\n      {!state.loading && (\r\n        <div className=\"info-bottom\">\r\n          <span\r\n            className=\"like\"\r\n            onClick={() => {\r\n              like();\r\n            }}\r\n            onMouseOver={() => setHovered(true)}\r\n            onMouseOut={() => setHovered(false)}\r\n          >\r\n            {!hovered ? (\r\n              state.liked ? (\r\n                <Liked className=\"like-icon\" />\r\n              ) : (\r\n                <Heart className=\"like-icon\" />\r\n              )\r\n            ) : !state.liked ? (\r\n              <Liked className=\"like-icon\" />\r\n            ) : (\r\n              <Heart className=\"like-icon\" />\r\n            )}\r\n            {state.likes > 0 && state.likes}\r\n          </span>\r\n          <span className=\"like\">\r\n            <Link to={`/post/${id}`} className=\"like-icon\">\r\n              <Comments />\r\n            </Link>\r\n            {state.comments > 0 && state.comments}\r\n          </span>\r\n          {/*<span>\r\n            <form className=\"cfrm\"  method=\"post\">\r\n              <div className=\"form-group comment-form\">\r\n                <input class=\"form-control\" type=\"text\" id=\"comment\" name=\"text\" />\r\n                  <button class=\"btn btn-outline-primary\" type=\"submit\" id=\"btn\" disabled>Comment</button>\r\n                </div>\r\n            </form>\r\n          </span>*/}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PostItem;\r\n","import React from \"react\";\r\n\r\nfunction Error({ error, componentStack, resetErrorBoundary }) {\r\n  return (\r\n    <div role=\"alert\">\r\n      <p>Something went wrong:</p>\r\n      <pre>{componentStack}</pre>\r\n      <button className=\"btn-teal btn\" onClick={resetErrorBoundary}>\r\n        Try again\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Error;\r\n","import React, { useState, lazy, Suspense } from \"react\";\r\nimport { Waypoint } from \"react-waypoint\";\r\nimport { useQuery } from \"@apollo/client\";\r\nimport { GET_POST } from \"../../Queries\";\r\nimport { ImpulseSpinner as Spinner } from \"react-spinners-kit\";\r\nimport { ErrorBoundary } from \"react-error-boundary\";\r\nimport Error from \"../layout/Error\";\r\nimport PostItem from \"./PostItem\";\r\n//const PostItem = lazy(() => import(\"./PostItem\"));\r\n\r\nconst Post = ({\r\n  match: {\r\n    params: { id },\r\n  },\r\n}) => {\r\n  const { loading, data, error, fetchMore, refetch } = useQuery(GET_POST, {\r\n    variables: { id },\r\n  });\r\n  const [spin, setSpin] = useState(true);\r\n\r\n  const more = () => {\r\n    fetchMore({\r\n      query: GET_POST,\r\n      variables: { cursor: data.post.postComments.pageInfo.endCursor },\r\n      updateQuery: (previousResult, { fetchMoreResult }) => {\r\n        setSpin(true);\r\n        if (!previousResult.post.postComments.pageInfo.hasNextPage) {\r\n          setSpin(false);\r\n          return previousResult;\r\n        }\r\n        const newEdges = fetchMoreResult.post.postComments.edges;\r\n        const pageInfo = fetchMoreResult.post.postComments.pageInfo;\r\n\r\n        return newEdges.length\r\n          ? {\r\n              post: {\r\n                ...previousResult.post,\r\n                postComments: {\r\n                  __typename: previousResult.post.postComments.__typename,\r\n                  edges: [...previousResult.post.posts.edges, ...newEdges],\r\n                  pageInfo,\r\n                },\r\n              },\r\n            }\r\n          : previousResult;\r\n      },\r\n    });\r\n  };\r\n\r\n  if (loading && !data) {\r\n    return <Spinner size={40} />;\r\n  }\r\n  const { node } = data.posts.edges[0];\r\n\r\n  return (\r\n    <ErrorBoundary FallbackComponent={Error}>\r\n      <div className=\"main\">\r\n        <PostItem\r\n          key={node.id}\r\n          likes={node.likers.length}\r\n          comments={node.commentSet.length}\r\n          user_id={node.user.id}\r\n          username={node.user.username}\r\n          {...node}\r\n        />\r\n        {data.postComments.edges.map(({ node }) => (\r\n          <>\r\n            <span>\r\n              <span>node.user.username</span>\r\n              <Link to={`post/${node.user.id}`} />\r\n            </span>\r\n            <h1>node.content</h1>\r\n          </>\r\n        ))}\r\n        <Waypoint onEnter={more}>\r\n          <div className=\"spinner\">\r\n            {(loading || spin) && <Spinner size={40} />}\r\n          </div>\r\n        </Waypoint>\r\n      </div>\r\n    </ErrorBoundary>\r\n  );\r\n};\r\n\r\nexport default Post;\r\n"],"sourceRoot":""}