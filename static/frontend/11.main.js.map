{"version":3,"sources":["webpack:///./src/components/post/PostItem.js"],"names":["useStyles","makeStyles","theme","button","margin","spacing","PostItem","text","title","username","id","likeCount","createdAt","user_id","commentCount","show_comment","imagePath","liked","classes","useState","comment","setComment","self","useRef","likePost","useMutation","LIKE","addComment","CREATE_COMMENT","done","hasMore","height","loading","expand","state","setState","expandText","useSpring","to","current","scrollHeight","from","duration","useEffect","clientHeight","style","maxHeight","className","alt","src","variant","substring","date","Date","timeStyle","pre","ref","onClick","startIcon","color","e","target","disabled","variables","post_id","update","cache","data","writeFragment","fragment","gql","post","error","console","log","onSubmit","preventDefault","createComment","postComments","readQuery","query","GET_POST","newData","edges","__typename","node","writeQuery","type","name","value","onChange","required"],"mappings":"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","file":"11.main.js","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\nimport { gql, useMutation } from \"@apollo/client\";\r\nimport { LIKED, LIKE, CREATE_COMMENT, GET_POST } from \"../../Queries\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { useSpring, animated } from \"react-spring\";\r\nimport Avatar from \"@material-ui/core/Avatar\";\r\nimport FavoriteTwoToneIcon from \"@material-ui/icons/FavoriteTwoTone\";\r\nimport CommentTwoToneIcon from \"@material-ui/icons/CommentTwoTone\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport FavoriteIcon from \"@material-ui/icons/Favorite\";\r\nimport ReactTimeAgo from \"react-time-ago\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  button: {\r\n    margin: theme.spacing(1.1),\r\n  },\r\n}));\r\n\r\nconst PostItem = ({\r\n  text,\r\n  title,\r\n  username,\r\n  id,\r\n  likeCount,\r\n  createdAt,\r\n  user_id,\r\n  commentCount,\r\n  show_comment,\r\n  imagePath,\r\n  liked,\r\n}) => {\r\n  const initialState = {\r\n    done: false,\r\n    hasMore: false,\r\n    height: \"32vh\",\r\n    loading: true,\r\n    expand: false,\r\n  };\r\n\r\n  const classes = useStyles();\r\n  const [comment, setComment] = useState(\"\");\r\n  const self = useRef(null);\r\n\r\n  const [likePost] = useMutation(LIKE);\r\n  const [addComment] = useMutation(CREATE_COMMENT);\r\n  const [state, setState] = useState(initialState);\r\n\r\n  const expandText = useSpring({\r\n    to: {\r\n      height: state.expand ? `${self.current.scrollHeight}px` : \"230px\",\r\n    },\r\n    from: {\r\n      height: !state.expand ? \"230px\" : `${self.current.scrollHeight}px`,\r\n    },\r\n    duration: \"0.9s\",\r\n  });\r\n\r\n  useEffect(() => {\r\n    const hasMore = self.current.scrollHeight > self.current.clientHeight;\r\n    if (hasMore) {\r\n      self.current.style.maxHeight = \"none\";\r\n      self.current.style.height = \"230px\";\r\n    }\r\n    setState({\r\n      ...state,\r\n      hasMore,\r\n      loading: false,\r\n    });\r\n  }, []);\r\n\r\n  const like = () => {\r\n    likePost({\r\n      variables: { post_id: id },\r\n      update: (cache, { data: { likePost } }) => {\r\n        if (cache) {\r\n          cache.writeFragment({\r\n            id: `PostNode:${id}`,\r\n            fragment: gql`\r\n              fragment Post on PostNode {\r\n                liked\r\n                likeCount\r\n              }\r\n            `,\r\n            data: {\r\n              likeCount: likePost.post.likeCount,\r\n              liked: likePost.post.liked,\r\n            },\r\n          });\r\n        }\r\n      },\r\n    }).catch((error) => console.log(error));\r\n  };\r\n\r\n  const add_comment = (e) => {\r\n    e.preventDefault();\r\n    addComment({\r\n      variables: { id, comment },\r\n      update: (cache, { data }) => {\r\n        if (cache) {\r\n          cache.writeFragment({\r\n            id: `PostNode:${id}`,\r\n            fragment: gql`\r\n              fragment Post on PostNode {\r\n                commentCount\r\n              }\r\n            `,\r\n            data: {\r\n              commentCount: data.createComment.comment.post.commentCount,\r\n            },\r\n          });\r\n          let { postComments } = cache.readQuery({\r\n            query: GET_POST,\r\n            variables: { id },\r\n          });\r\n          if (postComments) {\r\n            const newData = {\r\n              ...postComments,\r\n              edges: [\r\n                {\r\n                  __typename: \"CommentNodeConnection\",\r\n                  node: data.createComment.comment,\r\n                },\r\n                ...postComments.edges,\r\n              ],\r\n            };\r\n            cache.writeQuery({\r\n              query: GET_POST,\r\n              variables: { id },\r\n              data: {\r\n                postComments: newData,\r\n              },\r\n            });\r\n          }\r\n        }\r\n      },\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"post card\">\r\n      <div className=\"post-top card-top\">\r\n        <div className=\"post-info-top\">\r\n          <Link to={`/user/${user_id}`} className=\"post-user\">\r\n            <Avatar\r\n              alt={username}\r\n              src={imagePath}\r\n              variant=\"circle\"\r\n              style={{\r\n                margin: \"0.4em\",\r\n              }}\r\n            >\r\n              {username.substring(0, 1)}\r\n            </Avatar>{\" \"}\r\n            {username}{\" \"}\r\n          </Link>\r\n          <ReactTimeAgo\r\n            date={new Date(createdAt)}\r\n            timeStyle=\"round\"\r\n            className=\"post-time\"\r\n          />\r\n        </div>\r\n        <h5 className=\"post-title\">{title}</h5>\r\n      </div>\r\n      <animated.pre\r\n        ref={self}\r\n        className={`post-text`}\r\n        style={state.hasMore ? expandText : {}}\r\n      >\r\n        {text}\r\n        {state.hasMore && (\r\n          <button\r\n            className=\"more\"\r\n            onClick={() => {\r\n              setState({ ...state, expand: !state.expand });\r\n            }}\r\n          >\r\n            {state.expand ? \"less\" : \"more\"}\r\n          </button>\r\n        )}\r\n      </animated.pre>\r\n      {!state.loading && (\r\n        <>\r\n          <div className=\"info-bottom\">\r\n            <Button\r\n              className={\"w-auto d-block\" + classes.button}\r\n              variant=\"outlined\"\r\n              startIcon={\r\n                liked ? (\r\n                  <FavoriteIcon color=\"secondary\" />\r\n                ) : (\r\n                  <FavoriteTwoToneIcon />\r\n                )\r\n              }\r\n              onClick={(e) => {\r\n                e.target.disabled = \"true\";\r\n                like();\r\n                e.target.disabled = \"false\";\r\n              }}\r\n            >\r\n              {likeCount > 0 && likeCount}\r\n            </Button>\r\n            <Link to={`/post/${id}`}>\r\n              <Button\r\n                className={\"w-auto d-block\" + classes.button}\r\n                variant=\"outlined\"\r\n                color=\"primary\"\r\n                startIcon={<CommentTwoToneIcon />}\r\n              >\r\n                {commentCount > 0 && commentCount}\r\n              </Button>\r\n            </Link>\r\n          </div>\r\n\r\n          {show_comment && (\r\n            <span className=\"comment-form\">\r\n              <form onSubmit={add_comment} className=\"form-group comment-form\">\r\n                <input\r\n                  className=\"form-control\"\r\n                  type=\"text\"\r\n                  id=\"comment\"\r\n                  name=\"text\"\r\n                  value={comment}\r\n                  onChange={(e) => setComment(e.target.value)}\r\n                  required\r\n                />\r\n                <button className=\"btn btn-teal\" type=\"submit\" id=\"btn\">\r\n                  Comment\r\n                </button>\r\n              </form>\r\n            </span>\r\n          )}\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PostItem;\r\n"],"sourceRoot":""}