(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{"./src/components/post/PostItem.js":
/*!*****************************************!*\
  !*** ./src/components/post/PostItem.js ***!
  \*****************************************/
/*! exports provided: default */function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _apollo_client__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @apollo/client */ "./node_modules/@apollo/client/index.js");\n/* harmony import */ var _Queries__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../Queries */ "./src/Queries.js");\n/* harmony import */ var react_router_dom__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! react-router-dom */ "./node_modules/react-router-dom/esm/react-router-dom.js");\n/* harmony import */ var react_spring__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! react-spring */ "./node_modules/react-spring/web.js");\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== "undefined" && Symbol.iterator in Object(iter)) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { if (typeof Symbol === "undefined" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n\n\n\n\n\nvar Liked = /*#__PURE__*/Object(react__WEBPACK_IMPORTED_MODULE_0__["lazy"])(function () {\n  return __webpack_require__.e(/*! import() */ 11).then(__webpack_require__.bind(null, /*! ../SVG/Like.svg */ "./src/components/SVG/Like.svg"));\n});\nvar Heart = /*#__PURE__*/Object(react__WEBPACK_IMPORTED_MODULE_0__["lazy"])(function () {\n  return __webpack_require__.e(/*! import() */ 10).then(__webpack_require__.bind(null, /*! ../SVG/Heart.svg */ "./src/components/SVG/Heart.svg"));\n});\nvar Comments = /*#__PURE__*/Object(react__WEBPACK_IMPORTED_MODULE_0__["lazy"])(function () {\n  return __webpack_require__.e(/*! import() */ 9).then(__webpack_require__.bind(null, /*! ../SVG/Comments.svg */ "./src/components/SVG/Comments.svg"));\n});\n\nvar PostItem = function PostItem(_ref) {\n  var text = _ref.text,\n      title = _ref.title,\n      username = _ref.username,\n      id = _ref.id,\n      likeCount = _ref.likeCount,\n      createdAt = _ref.createdAt,\n      user_id = _ref.user_id,\n      commentCount = _ref.commentCount,\n      show_comment = _ref.show_comment;\n  var initialState = {\n    done: false,\n    likes: likeCount,\n    hasMore: false,\n    height: "32vh",\n    loading: true,\n    comments: commentCount,\n    expand: false\n  };\n\n  var _useLazyQuery = Object(_apollo_client__WEBPACK_IMPORTED_MODULE_1__["useLazyQuery"])(_Queries__WEBPACK_IMPORTED_MODULE_2__["LIKED"], {\n    variables: {\n      post_id: id\n    },\n    onCompleted: function onCompleted(data) {\n      setState(_objectSpread(_objectSpread({}, state), {}, {\n        liked: data.liked\n      }));\n    }\n  }),\n      _useLazyQuery2 = _slicedToArray(_useLazyQuery, 1),\n      liked = _useLazyQuery2[0];\n\n  var _useState = Object(react__WEBPACK_IMPORTED_MODULE_0__["useState"])(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      hovered = _useState2[0],\n      setHovered = _useState2[1];\n\n  var _useState3 = Object(react__WEBPACK_IMPORTED_MODULE_0__["useState"])(""),\n      _useState4 = _slicedToArray(_useState3, 2),\n      comment = _useState4[0],\n      setComment = _useState4[1];\n\n  var self = Object(react__WEBPACK_IMPORTED_MODULE_0__["useRef"])(null);\n\n  var _useMutation = Object(_apollo_client__WEBPACK_IMPORTED_MODULE_1__["useMutation"])(_Queries__WEBPACK_IMPORTED_MODULE_2__["LIKE"]),\n      _useMutation2 = _slicedToArray(_useMutation, 1),\n      likePost = _useMutation2[0];\n\n  var _useMutation3 = Object(_apollo_client__WEBPACK_IMPORTED_MODULE_1__["useMutation"])(_Queries__WEBPACK_IMPORTED_MODULE_2__["CREATE_COMMENT"]),\n      _useMutation4 = _slicedToArray(_useMutation3, 1),\n      addComment = _useMutation4[0];\n\n  var _useState5 = Object(react__WEBPACK_IMPORTED_MODULE_0__["useState"])(initialState),\n      _useState6 = _slicedToArray(_useState5, 2),\n      state = _useState6[0],\n      setState = _useState6[1];\n\n  var expandText = Object(react_spring__WEBPACK_IMPORTED_MODULE_4__["useSpring"])({\n    to: {\n      maxHeight: state.expand ? "".concat(self.current.scrollHeight, "px") : "230px",\n      height: state.expand ? "".concat(self.current.scrollHeight, "px") : "230px"\n    },\n    from: {\n      maxHeight: !state.expand ? "230px" : "".concat(self.current.scrollHeight, "px"),\n      height: !state.expand ? "230px" : "".concat(self.current.scrollHeight, "px")\n    },\n    duration: "0.9s"\n  });\n  Object(react__WEBPACK_IMPORTED_MODULE_0__["useEffect"])(function () {\n    liked();\n    setState(_objectSpread(_objectSpread({}, state), {}, {\n      hasMore: self.current.scrollHeight > self.current.clientHeight,\n      loading: false\n    }));\n  }, []);\n\n  var timeSince = function timeSince(date) {\n    var seconds = Math.floor((new Date() - date) / 1000);\n    var interval = seconds / 31536000;\n\n    if (interval > 1) {\n      var flr = Math.floor(interval);\n      return Math.floor(interval) + (flr === 1 ? " year" : " years");\n    }\n\n    interval = seconds / 2592000;\n\n    if (interval > 1) {\n      var _flr = Math.floor(interval);\n\n      return _flr + (_flr === 1 ? " month" : " months");\n    }\n\n    interval = seconds / 86400;\n\n    if (interval > 1) {\n      var _flr2 = Math.floor(interval);\n\n      return Math.floor(_flr2) + (_flr2 === 1 ? " day" : " days");\n    }\n\n    interval = seconds / 3600;\n\n    if (interval > 1) {\n      var _flr3 = Math.floor(interval);\n\n      return _flr3 + (_flr3 === 1 ? " hour" : " hours");\n    }\n\n    interval = seconds / 60;\n\n    if (interval > 1) {\n      var _flr4 = Math.floor(interval);\n\n      return _flr4 + (_flr4 == 1 ? " minute" : " minutes");\n    }\n\n    return "Seconds";\n  };\n\n  var like = function like() {\n    likePost({\n      variables: {\n        post_id: id\n      }\n    })["catch"](function (error) {\n      return console.log(error);\n    }).then(function (_ref2) {\n      var likePost = _ref2.data.likePost;\n      setState(_objectSpread(_objectSpread({}, state), {}, {\n        liked: !state.liked,\n        likes: likePost.post.likeCount\n      }));\n    });\n  };\n\n  var add_comment = function add_comment(e) {\n    e.preventDefault();\n    addComment({\n      variables: {\n        id: id,\n        comment: comment\n      },\n      update: function update(cache, _ref3) {\n        var data = _ref3.data;\n\n        if (cache) {\n          var _cache$readQuery = cache.readQuery({\n            query: _Queries__WEBPACK_IMPORTED_MODULE_2__["GET_POST"],\n            variables: {\n              id: id\n            }\n          }),\n              postComments = _cache$readQuery.postComments;\n\n          console.log(postComments);\n\n          if (postComments) {\n            var newData = _objectSpread(_objectSpread({}, postComments), {}, {\n              edges: [{\n                __typename: "CommentNodeConnection",\n                node: data.createComment.comment\n              }].concat(_toConsumableArray(postComments.edges))\n            });\n\n            cache.writeQuery({\n              query: _Queries__WEBPACK_IMPORTED_MODULE_2__["GET_POST"],\n              variables: {\n                id: id\n              },\n              data: {\n                postComments: newData\n              }\n            });\n          }\n        }\n      }\n    });\n  };\n\n  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div", {\n    className: "post card"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div", {\n    className: "post-top card-top"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div", {\n    className: "post-info-top"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react_router_dom__WEBPACK_IMPORTED_MODULE_3__["Link"], {\n    to: "user/".concat(user_id),\n    className: "post-user"\n  }, " ", username, " "), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("small", {\n    className: "post-time"\n  }, timeSince(new Date(createdAt)), " ago", " ")), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("h5", {\n    className: "post-title"\n  }, title)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react_spring__WEBPACK_IMPORTED_MODULE_4__["animated"].pre, {\n    ref: self,\n    className: "post-text",\n    style: state.hasMore ? expandText : {}\n  }, text, state.hasMore && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("button", {\n    className: "more",\n    onClick: function onClick() {\n      setState(_objectSpread(_objectSpread({}, state), {}, {\n        expand: !state.expand\n      }));\n    }\n  }, state.expand ? "less" : "more")), !state.loading && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_0___default.a.Fragment, null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div", {\n    className: "info-bottom"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("span", {\n    className: "like",\n    onClick: function onClick() {\n      like();\n    },\n    onMouseOver: function onMouseOver() {\n      return setHovered(true);\n    },\n    onMouseOut: function onMouseOut() {\n      return setHovered(false);\n    }\n  }, !hovered ? state.liked ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(Liked, {\n    className: "like-icon"\n  }) : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(Heart, {\n    className: "like-icon"\n  }) : !state.liked ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(Liked, {\n    className: "like-icon"\n  }) : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(Heart, {\n    className: "like-icon"\n  }), state.likes > 0 && state.likes), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("span", {\n    className: "like"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react_router_dom__WEBPACK_IMPORTED_MODULE_3__["Link"], {\n    to: "/post/".concat(id),\n    className: "like-icon"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(Comments, null)), state.comments > 0 && state.comments)), show_comment && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("span", {\n    className: "comment-form"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("form", {\n    onSubmit: add_comment,\n    className: "form-group comment-form"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("input", {\n    className: "form-control",\n    type: "text",\n    id: "comment",\n    name: "text",\n    value: comment,\n    onChange: function onChange(e) {\n      return setComment(e.target.value);\n    }\n  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("button", {\n    className: "btn btn-teal",\n    type: "submit",\n    id: "btn"\n  }, "Comment")))));\n};\n\n/* harmony default export */ __webpack_exports__["default"] = (PostItem);\n\n//# sourceURL=webpack:///./src/components/post/PostItem.js?')}}]);